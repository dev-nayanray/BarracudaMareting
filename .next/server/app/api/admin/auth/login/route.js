"use strict";(()=>{var e={};e.id=840,e.ids=[840],e.modules={8013:e=>{e.exports=require("mongodb")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4770:e=>{e.exports=require("crypto")},743:(e,a,t)=>{t.r(a),t.d(a,{originalPathname:()=>h,patchFetch:()=>I,requestAsyncStorage:()=>x,routeModule:()=>w,serverHooks:()=>f,staticGenerationAsyncStorage:()=>g});var n={};t.r(n),t.d(n,{POST:()=>p});var i=t(9303),r=t(8716),o=t(670),s=t(7070),c=t(2021),l=t(4770),d=t.n(l);function u(e){return d().createHash("sha256").update(e).digest("hex")}let m={email:"admin@barracuda.com",password:"admin123"};async function p(e){try{let{db:a}=await (0,c.vO)(),t=(0,c.ac)(a),{email:n,password:i}=await e.json();if(!n||!i)return s.NextResponse.json({success:!1,message:"Email and password are required"},{status:400});let r=await t.findOne({email:m.email});if(r||(await t.insertOne({email:m.email,password:u(m.password),name:"Admin",role:"admin",createdAt:new Date}),console.log("✅ Created default admin user"),r=await t.findOne({email:m.email})),n===m.email&&i===m.password){let e=d().randomBytes(32).toString("hex"),a=u(e);return await t.updateOne({email:m.email},{$set:{lastLogin:new Date,tokenHash:a}}),s.NextResponse.json({success:!0,data:{token:e,email:m.email,name:"Admin",role:"admin"}})}let o=u(i);if(r=await t.findOne({email:n,password:o})){let e=d().randomBytes(32).toString("hex"),a=u(e);return await t.updateOne({email:n},{$set:{lastLogin:new Date,tokenHash:a}}),s.NextResponse.json({success:!0,data:{token:e,email:r.email,name:r.name,role:r.role}})}return s.NextResponse.json({success:!1,message:"Invalid email or password"},{status:401})}catch(e){return console.error("Login error:",e),s.NextResponse.json({success:!1,message:"Internal server error"},{status:500})}}let w=new i.AppRouteRouteModule({definition:{kind:r.x.APP_ROUTE,page:"/api/admin/auth/login/route",pathname:"/api/admin/auth/login",filename:"route",bundlePath:"app/api/admin/auth/login/route"},resolvedPagePath:"C:\\Users\\USER\\Desktop\\BarracudaMareting\\app\\api\\admin\\auth\\login\\route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:x,staticGenerationAsyncStorage:g,serverHooks:f}=w,h="/api/admin/auth/login/route";function I(){return(0,o.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:g})}},2021:(e,a,t)=>{t.d(a,{BF:()=>u,CL:()=>d,MU:()=>m,ac:()=>p,g:()=>w,vO:()=>c});var n=t(8013);let i=null,r=null,o=process.env.MONGODB_URI||"mongodb://127.0.0.1:27017",s=process.env.DB_NAME||"barracuda";async function c(){if(i&&r)return{client:i,db:r};try{return i=new n.MongoClient(o),await i.connect(),r=i.db(s),console.log("✅ Connected to MongoDB"),await l(r),{client:i,db:r}}catch(e){throw console.error("❌ MongoDB connection error:",e),e}}async function l(e){let a=e.collection("contacts");await a.createIndex({email:1}),await a.createIndex({type:1}),await a.createIndex({status:1}),await a.createIndex({affiliate_id:1}),await a.createIndex({createdAt:-1}),await a.createIndex({sub1:1});let t=e.collection("postbacks");await t.createIndex({click_id:1,goal:1},{unique:!0}),await t.createIndex({affiliate_id:1}),await t.createIndex({createdAt:-1});let n=e.collection("ftds");await n.createIndex({click_id:1},{unique:!0}),await n.createIndex({affiliate_id:1}),await n.createIndex({createdAt:-1});let i=e.collection("admins");await i.createIndex({email:1},{unique:!0});let r=e.collection("conversions");await r.createIndex({click_id:1,goal_id:1},{unique:!0}),await r.createIndex({affiliate_id:1}),await r.createIndex({goal_type:1}),await r.createIndex({createdAt:-1}),console.log("✅ Database indexes created")}function d(e){return e.collection("contacts")}function u(e){return e.collection("postbacks")}function m(e){return e.collection("ftds")}function p(e){return e.collection("admins")}function w(e){return e.collection("conversions")}}};var a=require("../../../../../webpack-runtime.js");a.C(e);var t=e=>a(a.s=e),n=a.X(0,[276,972],()=>t(743));module.exports=n})();