"use strict";(()=>{var e={};e.id=115,e.ids=[115],e.modules={8013:e=>{e.exports=require("mongodb")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},9328:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>w,patchFetch:()=>m,requestAsyncStorage:()=>l,routeModule:()=>d,serverHooks:()=>g,staticGenerationAsyncStorage:()=>p});var n={};a.r(n),a.d(n,{GET:()=>u});var r=a(9303),o=a(8716),i=a(670),c=a(7070),s=a(2021);async function u(e){try{let{db:e}=await (0,s.vO)(),t=(0,s.CL)(e),a=(0,s.MU)(e),n=await t.countDocuments(),r=await t.countDocuments({createdAt:{$gte:new Date(new Date().getFullYear(),new Date().getMonth(),1)}}),o=await t.aggregate([{$group:{_id:"$type",count:{$sum:1}}}]).toArray(),i=await t.aggregate([{$group:{_id:"$status",count:{$sum:1}}}]).toArray(),u=await t.aggregate([{$match:{type:"affiliate"}},{$group:{_id:"$affiliate_status",count:{$sum:1}}}]).toArray(),d=await a.countDocuments(),l=await a.aggregate([{$group:{_id:null,total:{$sum:"$amount"}}}]).toArray(),p=e=>e.reduce((e,t)=>(e[t._id]=t.count,e),{});return c.NextResponse.json({success:!0,data:{total:n,thisMonth:r,byType:p(o),byStatus:p(i),affiliateStats:p(u),ftd:{total:d,revenue:l[0]?.total||0}}})}catch(e){return console.error("Get stats error:",e),c.NextResponse.json({success:!1,message:"Internal server error"},{status:500})}}let d=new r.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/admin/contacts/stats/route",pathname:"/api/admin/contacts/stats",filename:"route",bundlePath:"app/api/admin/contacts/stats/route"},resolvedPagePath:"C:\\Users\\USER\\Desktop\\BarracudaMareting\\app\\api\\admin\\contacts\\stats\\route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:l,staticGenerationAsyncStorage:p,serverHooks:g}=d,w="/api/admin/contacts/stats/route";function m(){return(0,i.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:p})}},2021:(e,t,a)=>{a.d(t,{BF:()=>l,CL:()=>d,MU:()=>p,ac:()=>g,g:()=>w,vO:()=>s});var n=a(8013);let r=null,o=null,i=process.env.MONGODB_URI||"mongodb://127.0.0.1:27017",c=process.env.DB_NAME||"barracuda";async function s(){if(r&&o)return{client:r,db:o};try{return r=new n.MongoClient(i),await r.connect(),o=r.db(c),console.log("✅ Connected to MongoDB"),await u(o),{client:r,db:o}}catch(e){throw console.error("❌ MongoDB connection error:",e),e}}async function u(e){let t=e.collection("contacts");await t.createIndex({email:1}),await t.createIndex({type:1}),await t.createIndex({status:1}),await t.createIndex({affiliate_id:1}),await t.createIndex({createdAt:-1}),await t.createIndex({sub1:1});let a=e.collection("postbacks");await a.createIndex({click_id:1,goal:1},{unique:!0}),await a.createIndex({affiliate_id:1}),await a.createIndex({createdAt:-1});let n=e.collection("ftds");await n.createIndex({click_id:1},{unique:!0}),await n.createIndex({affiliate_id:1}),await n.createIndex({createdAt:-1});let r=e.collection("admins");await r.createIndex({email:1},{unique:!0});let o=e.collection("conversions");await o.createIndex({click_id:1,goal_id:1},{unique:!0}),await o.createIndex({affiliate_id:1}),await o.createIndex({goal_type:1}),await o.createIndex({createdAt:-1}),console.log("✅ Database indexes created")}function d(e){return e.collection("contacts")}function l(e){return e.collection("postbacks")}function p(e){return e.collection("ftds")}function g(e){return e.collection("admins")}function w(e){return e.collection("conversions")}}};var t=require("../../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),n=t.X(0,[276,972],()=>a(9328));module.exports=n})();