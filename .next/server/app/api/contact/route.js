"use strict";(()=>{var e={};e.id=386,e.ids=[386],e.modules={8013:e=>{e.exports=require("mongodb")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},7992:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>m,patchFetch:()=>w,requestAsyncStorage:()=>g,routeModule:()=>p,serverHooks:()=>_,staticGenerationAsyncStorage:()=>f});var s={};a.r(s),a.d(s,{POST:()=>u});var o=a(9303),i=a(8716),n=a(670),c=a(7070),d=a(2021);let r={baseUrl:"https://hooplaseft.com/api/v3",goalRegistration:"5",goalDeposit:"6",hash:process.env.HOOPLASEFT_HASH||"52631455a41fec8cb6ceafce98fc75a5"};async function l(e,t,a,s={}){try{let o=new URLSearchParams({hash:r.hash,click_id:t,affiliate_id:a,...s}),i=`${r.baseUrl}/goal/${e}?${o.toString()}`;console.log(`ðŸŽ¯ Sending Hooplaseft Goal #${e} postback:`),console.log(`   URL: ${i}`),console.log(`   Click ID: ${t}`),console.log(`   Affiliate ID: ${a}`);let n=await fetch(i,{method:"GET",headers:{"User-Agent":"Next.js Affiliate API",Accept:"application/json"}}),c=await n.text();return console.log(`âœ… Hooplaseft Goal #${e} response (${n.status}):`,c.substring(0,300)),{success:n.ok,message:c,statusCode:n.status}}catch(t){return console.error(`âŒ Hooplaseft Goal #${e} error:`,t.message),{success:!1,message:t.message,statusCode:500}}}async function u(e){try{let{db:t}=await (0,d.vO)(),a=(0,d.CL)(t),s=(0,d.BF)(t),o=(0,d.g)(t),{name:i,email:n,type:u,affiliate_id:p,url_id:g,sub1:f,sub2:_,sub3:m,company:w,messenger:b,username:v,message:D,trackingSource:A,deposit_amount:k,sale_amount:I}=await e.json();if(console.log("\n========== CONTACT FORM SUBMISSION =========="),console.log("Email:",n),console.log("Type:",u),console.log("Affiliate ID:",p),console.log("URL ID (click_id):",g),console.log("Sub1:",f),console.log("Deposit Amount:",k),console.log("==============================================\n"),!n||!u)return c.NextResponse.json({success:!1,message:"Email and type are required."},{status:400});if(await a.findOne({email:n}))return console.log("âš ï¸ Duplicate email:",n),c.NextResponse.json({success:!1,message:"This email has already been registered."},{status:409});let x={name:i||"",email:n,company:w||"",type:u,messenger:b||void 0,username:v||void 0,message:D||void 0,affiliate_id:p||void 0,url_id:g||void 0,sub1:f||void 0,sub2:_||void 0,sub3:m||void 0,tracking_source:A||"contact_form",status:"new",affiliate_status:"affiliate"===u?"pending":void 0,affiliateRegistered:!1,ftd:!1,createdAt:new Date,updatedAt:new Date},h=await a.findOneAndUpdate({email:n},{$setOnInsert:x},{upsert:!0,returnDocument:"after"});if(!(h?.createdAt&&h.createdAt>=new Date(Date.now()-1e3)))return c.NextResponse.json({success:!1,message:"This email has already been registered."},{status:409});if(console.log("âœ… Contact saved to MongoDB:",h?._id),u){let e=p||"2",t=g||"2",d=f||`click_${Date.now()}`;console.log("\uD83C\uDFAF Sending Hooplaseft Registration Postback (Goal #5)");let b=await l(r.goalRegistration,t,e,{sub1:d,sub2:_||"",sub3:m||"",goal_type:"registration",name:encodeURIComponent(i||""),email:encodeURIComponent(n),company:encodeURIComponent(w||"")});console.log(`   Registration postback success: ${b.success}`),await o.findOneAndUpdate({click_id:t,goal_id:r.goalRegistration},{$setOnInsert:{click_id:t,affiliate_id:e,goal_id:r.goalRegistration,goal_type:"registration",offer_id:"2",amount:0,sale_amount:void 0,status:b.success?"approved":"pending",sub1:d,sub2:_||void 0,sub3:m||void 0,metadata:{name:i,email:n,company:w,user_type:u,postbackResponse:b.message,postbackSuccess:b.success},createdAt:new Date},$set:{updatedAt:new Date}},{upsert:!0}),console.log("âœ… Registration conversion saved"),b.success&&(await a.updateOne({_id:h?._id},{$set:{affiliateRegistered:!0,updatedAt:new Date}}),console.log("âœ… Updated contact affiliateRegistered to true"));let v=k||100;await a.updateOne({_id:h?._id},{$set:{ftd:!0,ftd_date:new Date,ftd_amount:v,updatedAt:new Date}}),console.log("âœ… Auto-completed FTD for contact (ftd=true, ftd_amount="+v+")"),console.log("\uD83C\uDFAF Sending Hooplaseft Deposit Postback (Goal #6)");let D=await l(r.goalDeposit,t,e,{sub1:d,sub2:_||"",sub3:m||"",goal_type:"deposit",deposit_amount:v.toString(),sale_amount:(I||v).toString()});return console.log(`   Deposit postback success: ${D.success}`),await o.findOneAndUpdate({click_id:t,goal_id:r.goalDeposit},{$setOnInsert:{click_id:t,affiliate_id:e,goal_id:r.goalDeposit,goal_type:"deposit",offer_id:"2",amount:v,sale_amount:I||v,status:D.success?"approved":"pending",sub1:d,sub2:_||void 0,sub3:m||void 0,metadata:{name:i,email:n,company:w,user_type:u,postbackResponse:D.message,postbackSuccess:D.success},createdAt:new Date},$set:{updatedAt:new Date}},{upsert:!0}),console.log("âœ… Deposit conversion saved"),await s.findOneAndUpdate({click_id:t,goal:"registration"},{$setOnInsert:{click_id:t,affiliate_id:e,offer_id:void 0,goal:"registration",amount:void 0,sale_amount:void 0,status:"pending",sub1:d,sub2:_||void 0,sub3:m||void 0,createdAt:new Date},$set:{updatedAt:new Date}},{upsert:!0}),console.log("âœ… Registration postback saved"),await s.findOneAndUpdate({click_id:t,goal:"deposit"},{$setOnInsert:{click_id:t,affiliate_id:e,offer_id:void 0,goal:"deposit",amount:v,sale_amount:I||v,status:D.success?"approved":"pending",sub1:d,sub2:_||void 0,sub3:m||void 0,createdAt:new Date},$set:{updatedAt:new Date}},{upsert:!0}),console.log("âœ… Deposit postback saved"),c.NextResponse.json({success:!0,message:"affiliate"===u?"Affiliate application submitted successfully.":"Registration completed successfully.",data:{affiliateApplied:"affiliate"===u,affiliatePosted:!0,isAffiliate:"affiliate"===u,affiliateRegistered:b.success,ftd:!0,ftd_amount:v,registrationStatus:b.success?"approved":"pending",depositStatus:D.success?"approved":"pending",userType:u,clickId:t,affiliateId:e,sub1:d,note:"affiliate"===u?"Your application is under review. You will receive dashboard access within 24 hours.":"Thank you for registering. Our team will contact you within 24 hours."}})}if("affiliate"===u&&p&&g&&k&&k>0){console.log("\uD83C\uDFAF Sending Deposit Postback (Goal #6)");let e=await l(r.goalDeposit,g,p,{sub1:f||"",sub2:_||"",sub3:m||"",goal_type:"deposit",deposit_amount:k.toString(),sale_amount:(I||k).toString()});return await o.findOneAndUpdate({click_id:g,goal_id:r.goalDeposit},{$setOnInsert:{click_id:g,affiliate_id:p,goal_id:r.goalDeposit,goal_type:"deposit",offer_id:"2",amount:k,sale_amount:I||k,status:e.success?"approved":"pending",sub1:f||void 0,sub2:_||void 0,sub3:m||void 0,metadata:{name:i,email:n,company:w},createdAt:new Date},$set:{updatedAt:new Date}},{upsert:!0}),e.success&&await a.updateOne({_id:h?._id},{$set:{ftd:!0,ftd_date:new Date,ftd_amount:k,updatedAt:new Date}}),c.NextResponse.json({success:!0,message:"Deposit postback sent successfully.",data:{affiliateApplied:!0,ftd:e.success,ftd_amount:k}})}return c.NextResponse.json({success:!0,message:"Registration successful. Our team will contact you within 24 hours.",data:{isAffiliate:!1,posted:!0}})}catch(e){return console.error("Registration API error:",e),c.NextResponse.json({success:!1,message:"Internal server error"},{status:500})}}let p=new o.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/contact/route",pathname:"/api/contact",filename:"route",bundlePath:"app/api/contact/route"},resolvedPagePath:"C:\\Users\\USER\\Desktop\\BarracudaMareting\\app\\api\\contact\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:g,staticGenerationAsyncStorage:f,serverHooks:_}=p,m="/api/contact/route";function w(){return(0,n.patchFetch)({serverHooks:_,staticGenerationAsyncStorage:f})}},2021:(e,t,a)=>{a.d(t,{BF:()=>u,CL:()=>l,MU:()=>p,ac:()=>g,g:()=>f,vO:()=>d});var s=a(8013);let o=null,i=null,n=process.env.MONGODB_URI||"mongodb://127.0.0.1:27017",c=process.env.DB_NAME||"barracuda";async function d(){if(o&&i)return{client:o,db:i};try{return o=new s.MongoClient(n),await o.connect(),i=o.db(c),console.log("âœ… Connected to MongoDB"),await r(i),{client:o,db:i}}catch(e){throw console.error("âŒ MongoDB connection error:",e),e}}async function r(e){let t=e.collection("contacts");await t.createIndex({email:1}),await t.createIndex({type:1}),await t.createIndex({status:1}),await t.createIndex({affiliate_id:1}),await t.createIndex({createdAt:-1}),await t.createIndex({sub1:1});let a=e.collection("postbacks");await a.createIndex({click_id:1,goal:1},{unique:!0}),await a.createIndex({affiliate_id:1}),await a.createIndex({createdAt:-1});let s=e.collection("ftds");await s.createIndex({click_id:1},{unique:!0}),await s.createIndex({affiliate_id:1}),await s.createIndex({createdAt:-1});let o=e.collection("admins");await o.createIndex({email:1},{unique:!0});let i=e.collection("conversions");await i.createIndex({click_id:1,goal_id:1},{unique:!0}),await i.createIndex({affiliate_id:1}),await i.createIndex({goal_type:1}),await i.createIndex({createdAt:-1}),console.log("âœ… Database indexes created")}function l(e){return e.collection("contacts")}function u(e){return e.collection("postbacks")}function p(e){return e.collection("ftds")}function g(e){return e.collection("admins")}function f(e){return e.collection("conversions")}}};var t=require("../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),s=t.X(0,[276,972],()=>a(7992));module.exports=s})();