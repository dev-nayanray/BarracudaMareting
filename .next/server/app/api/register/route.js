"use strict";(()=>{var e={};e.id=569,e.ids=[569],e.modules={8013:e=>{e.exports=require("mongodb")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},7627:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>_,patchFetch:()=>w,requestAsyncStorage:()=>g,routeModule:()=>p,serverHooks:()=>m,staticGenerationAsyncStorage:()=>f});var o={};a.r(o),a.d(o,{POST:()=>u});var i=a(9303),s=a(8716),n=a(670),r=a(7070),d=a(2021);let c={baseUrl:"https://hooplaseft.com/api/v3",goalRegistration:"5",goalDeposit:"6",hash:process.env.HOOPLASEFT_HASH||"eb20d583f46d5dc303e251607e04d240"};async function l(e,t,a,o={}){try{let i=new URLSearchParams({hash:c.hash,click_id:t,affiliate_id:a,...o}),s=`${c.baseUrl}/goal/${e}?${i.toString()}`;console.log(`ðŸŽ¯ Sending Hooplaseft Goal #${e} postback:`,s);let n=await fetch(s,{method:"GET",headers:{"User-Agent":"Next.js Affiliate API",Accept:"application/json"}}),r=await n.text();return console.log(`âœ… Hooplaseft Goal #${e} response:`,r.substring(0,200)),{success:n.ok,message:r}}catch(t){return console.error(`âŒ Hooplaseft Goal #${e} error:`,t.message),{success:!1,message:t.message}}}async function u(e){try{let{db:t}=await (0,d.vO)(),a=(0,d.CL)(t),o=(0,d.BF)(t),i=(0,d.g)(t),{name:s,email:n,company:u,type:p,messenger:g,username:f,message:m,affiliate_id:_,url_id:w,sub1:v,sub2:b,sub3:D,campaignId:A,trackingSource:h,deposit_amount:x,sale_amount:I}=await e.json();if(!s||!n||!u||!p)return r.NextResponse.json({success:!1,message:"Name, email, company, and type are required."},{status:400});if(await a.findOne({email:n}))return r.NextResponse.json({success:!1,message:"This email has already been registered."},{status:409});let R={name:s,email:n,company:u,type:p,messenger:g||void 0,username:f||void 0,message:m||void 0,affiliate_id:_||void 0,url_id:w||void 0,sub1:v||void 0,sub2:b||void 0,sub3:D||void 0,campaign_id:A||void 0,tracking_source:h||"contact_form",status:"new",affiliate_status:"affiliate"===p?"pending":void 0,affiliateRegistered:!1,affiliateError:void 0,ftd:!1,createdAt:new Date,updatedAt:new Date},U=await a.findOneAndUpdate({email:n},{$setOnInsert:R},{upsert:!0,returnDocument:"after"});if(!(U?.createdAt&&U.createdAt>=new Date(Date.now()-1e3)))return r.NextResponse.json({success:!1,message:"This email has already been registered."},{status:409});if(console.log("âœ… Contact saved to MongoDB:",U?._id),"affiliate"===p){let e=new URLSearchParams({affiliate_id:_||"2",url_id:w||"2",source:h||"contact_form",name:encodeURIComponent(s),email:encodeURIComponent(n),company:encodeURIComponent(u)});v&&e.append("sub1",encodeURIComponent(v)),A&&e.append("campaign_id",encodeURIComponent(A)),x&&e.append("deposit_amount",x.toString()),I&&e.append("sale_amount",I.toString()),e.append("unique","1");let t=`https://hooplaseft.com/api/v3/offer/2?${e.toString()}`;if(fetch(t,{method:"GET",headers:{"User-Agent":"Next.js Affiliate API"}}).catch(e=>console.log("Hooplaseft API call failed:",e.message)),_&&w){console.log("\uD83C\uDFAF Sending Hooplaseft Registration Postback (Goal #5)");let e=await l(c.goalRegistration,w,_,{sub1:v||"",sub2:b||"",sub3:D||"",goal_type:"registration",name:encodeURIComponent(s),email:encodeURIComponent(n),company:encodeURIComponent(u)});if(await i.findOneAndUpdate({click_id:w,goal_id:c.goalRegistration},{$setOnInsert:{click_id:w,affiliate_id:_,goal_id:c.goalRegistration,goal_type:"registration",offer_id:"2",amount:0,sale_amount:void 0,status:e.success?"approved":"pending",sub1:v||void 0,sub2:b||void 0,sub3:D||void 0,metadata:{name:s,email:n,company:u,deposit_amount:x||void 0},createdAt:new Date},$set:{updatedAt:new Date}},{upsert:!0}),console.log("âœ… Registration conversion saved to MongoDB"),e.success){await a.updateOne({_id:U?._id},{$set:{affiliateRegistered:!0,affiliateError:void 0,updatedAt:new Date}}),console.log("âœ… Updated contact affiliateRegistered to true");let e=x||100;await a.updateOne({_id:U?._id},{$set:{ftd:!0,ftd_date:new Date,ftd_amount:e,updatedAt:new Date}}),console.log("âœ… Auto-completed FTD for contact:",U?._id),console.log("\uD83C\uDFAF Sending Hooplaseft Deposit Postback (Goal #6)");let t=await l(c.goalDeposit,w,_,{sub1:v||"",sub2:b||"",sub3:D||"",goal_type:"deposit",deposit_amount:e.toString(),sale_amount:I?.toString()||e.toString()});await i.findOneAndUpdate({click_id:w,goal_id:c.goalDeposit},{$setOnInsert:{click_id:w,affiliate_id:_,goal_id:c.goalDeposit,goal_type:"deposit",offer_id:"2",amount:e,sale_amount:I||e,status:t.success?"approved":"pending",sub1:v||void 0,sub2:b||void 0,sub3:D||void 0,metadata:{name:s,email:n,company:u},createdAt:new Date},$set:{updatedAt:new Date}},{upsert:!0}),console.log("âœ… Deposit conversion saved to MongoDB")}else await a.updateOne({_id:U?._id},{$set:{affiliateError:e.message,updatedAt:new Date}})}if(_&&w&&x&&x>0){console.log("\uD83C\uDFAF Sending Hooplaseft Deposit Postback (Goal #6)");let e=await l(c.goalDeposit,w,_,{sub1:v||"",sub2:b||"",sub3:D||"",goal_type:"deposit",deposit_amount:x.toString(),sale_amount:I?.toString()||x.toString()});await i.findOneAndUpdate({click_id:w,goal_id:c.goalDeposit},{$setOnInsert:{click_id:w,affiliate_id:_,goal_id:c.goalDeposit,goal_type:"deposit",offer_id:"2",amount:x,sale_amount:I||x,status:e.success?"approved":"pending",sub1:v||void 0,sub2:b||void 0,sub3:D||void 0,metadata:{name:s,email:n,company:u},createdAt:new Date},$set:{updatedAt:new Date}},{upsert:!0}),console.log("âœ… Deposit conversion saved to MongoDB"),e.success&&(await a.updateOne({_id:U?._id},{$set:{ftd:!0,ftd_date:new Date,ftd_amount:x,updatedAt:new Date}}),console.log("âœ… Updated contact FTD status to true"))}return _&&w&&(await o.findOneAndUpdate({click_id:w,goal:"registration"},{$setOnInsert:{click_id:w,affiliate_id:_,offer_id:void 0,goal:"registration",amount:void 0,sale_amount:void 0,status:"pending",sub1:v||void 0,sub2:b||void 0,sub3:D||void 0,createdAt:new Date},$set:{updatedAt:new Date}},{upsert:!0}),console.log("âœ… Postback saved to MongoDB for tracking")),r.NextResponse.json({success:!0,message:"Affiliate registration submitted successfully.",data:{affiliatePosted:!0,isAffiliate:!0,trackingLink:t,affiliateId:_||"2",dashboardUrl:"https://barracuda-pp.irev.com/affiliates/en/app/dashboard",note:"Your application is under review. You will receive iREV dashboard access within 24 hours via email."}})}return r.NextResponse.json({success:!0,message:"Registration successful. Our team will contact you within 24 hours.",data:{isAffiliate:!1,posted:!0}})}catch(e){return console.error("Register API error:",e),r.NextResponse.json({success:!1,message:e.message||"Internal server error",data:{affiliateError:!0}},{status:500})}}let p=new i.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/register/route",pathname:"/api/register",filename:"route",bundlePath:"app/api/register/route"},resolvedPagePath:"C:\\Users\\USER\\Desktop\\BarracudaMareting\\app\\api\\register\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:g,staticGenerationAsyncStorage:f,serverHooks:m}=p,_="/api/register/route";function w(){return(0,n.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:f})}},2021:(e,t,a)=>{a.d(t,{BF:()=>u,CL:()=>l,MU:()=>p,ac:()=>g,g:()=>f,vO:()=>d});var o=a(8013);let i=null,s=null,n=process.env.MONGODB_URI||"mongodb://127.0.0.1:27017",r=process.env.DB_NAME||"barracuda";async function d(){if(i&&s)return{client:i,db:s};try{return i=new o.MongoClient(n),await i.connect(),s=i.db(r),console.log("âœ… Connected to MongoDB"),await c(s),{client:i,db:s}}catch(e){throw console.error("âŒ MongoDB connection error:",e),e}}async function c(e){let t=e.collection("contacts");await t.createIndex({email:1}),await t.createIndex({type:1}),await t.createIndex({status:1}),await t.createIndex({affiliate_id:1}),await t.createIndex({createdAt:-1}),await t.createIndex({sub1:1});let a=e.collection("postbacks");await a.createIndex({click_id:1,goal:1},{unique:!0}),await a.createIndex({affiliate_id:1}),await a.createIndex({createdAt:-1});let o=e.collection("ftds");await o.createIndex({click_id:1},{unique:!0}),await o.createIndex({affiliate_id:1}),await o.createIndex({createdAt:-1});let i=e.collection("admins");await i.createIndex({email:1},{unique:!0});let s=e.collection("conversions");await s.createIndex({click_id:1,goal_id:1},{unique:!0}),await s.createIndex({affiliate_id:1}),await s.createIndex({goal_type:1}),await s.createIndex({createdAt:-1}),console.log("âœ… Database indexes created")}function l(e){return e.collection("contacts")}function u(e){return e.collection("postbacks")}function p(e){return e.collection("ftds")}function g(e){return e.collection("admins")}function f(e){return e.collection("conversions")}}};var t=require("../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),o=t.X(0,[276,972],()=>a(7627));module.exports=o})();